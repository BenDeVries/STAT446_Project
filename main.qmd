---
title: "STAT446_proj"
format: pdf
editor: source
---

## Quarto

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.

## Running Code

When you click the **Render** button a document will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r}
1 + 1
```

You can add options to executable code like this

```{r}
#| echo: false
2 * 2
```

The `echo: false` option disables the printing of code (only output is displayed).


```{r}
library(glmnet)
library(tidyverse)
library(ggplot2)
library(caret)
set.seed(446)

dat <- read_csv("heart_disease2015.csv")
sum(is.na(dat))
factor_vars <- colnames(dat[, c(-1, -5, -20, -16, -17)])
dat[factor_vars] <- lapply(dat[factor_vars], factor)
dat$stratum <- paste(dat$Sex, dat$Smoker, dat$Income, sep = "")
train_size <- 10000
train_inds <- createDataPartition(dat$stratum,
                                  p = train_size / dim(dat)[1],
                                  list = F)
TRAIN <- dat[c(train_inds), 1 : 23]
VAL <- dat[-c(train_inds), 1 : 22]

ggplot(data = dat) +
  geom_bar(aes(stratum))
ggplot(data = TRAIN) +
  geom_bar(aes(stratum))


#Preliminary results, no interactions or polynomials
X_T <- model.matrix(HeartDiseaseorAttack ~ ., TRAIN[, 1 : 22])[, -1]
Y_T <- TRAIN$HeartDiseaseorAttack
X_V <- model.matrix(HeartDiseaseorAttack ~ ., VAL)[, -1]
Y_V <- VAL$HeartDiseaseorAttack
num_folds <- 10
folds <- loo::kfold_split_stratified(10, TRAIN$stratum)
cross_val <- cv.glmnet(X_T, Y_T, alpha = 1, familly = binomial,
                       foldid = folds)
plot(cross_val)
coef(cross_val, lamb)
m0 <- glmnet(X_T, Y_T, family = binomial, lambda = cross_val$lambda.min,
             alpha = 1)
preds <- predict(m0, newx = X_V, type = "link")
preds <- ifelse(preds > 0, 1, 0)
#Overall accuracy
sum(preds == Y_V) / length(Y_V)
cm <- confusionMatrix(reference = factor(Y_V), data = factor(preds))
cm
fourfoldplot(as.table(cm), color = c("purple", "gold"),
             main = "Confusion Matrix")
```




